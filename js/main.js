!function(){"use strict";function l(e,t){if(!e)return!1;for(var n=0,i=e.length;n<i;n++)if(null!=e[n]&&t(e[n],n))return!0;return!1}class o{element=null;constructor(e){this.element=e}addChild(e){this.element.appendChild(e.element)}addChilds(...e){e.forEach(e=>{Array.isArray(e)?e.forEach(e=>this.addChild(e)):"object"==typeof e&&this.addChild(e)})}insChild(e,t){var n=this.element;"number"==typeof t?0<=t||t<n.childElementCount?n.insertBefore(e.element,n.children[t]):t<0||t>=-n.childElementCount?n.insertBefore(e.element,n.children[n.childElementCount+t]):n.appendChild(e.element):n.insertBefore(e.element,t.element)}childInd(n){var i=-1;return l(this.element.children,(e,t)=>{if(e==n.element)return i=t,!0}),i}remove(){this.element.remove()}removeChilds(e=0,t=1/0){var n=this.element;t>n.childElementCount&&(t=n.childElementCount);for(var i=e;i<t;i++)n.children[e].remove()}setStyle(e,t){this.element.style[e]=t}getStyle(e){if("string"==typeof e)return this.element.style[e]}setStyles(i){l(Object.keys(i),e=>{var t,n=i[e];t=typeof n,l(["number","string"],e=>e==t)&&(this.element.style[e]=i[e])})}setText(e){this.element.innerText=e}setAttrs(t){l(Object.keys(t),e=>{this.element[e]=t[e]})}setDisplay(e){this.setStyle("display",e)}addEventListener(e,t,n){this.element.addEventListener(e,t,n)}removeEventListener(e,t,n){this.element.removeEventListener(e,t,n)}}const t=Symbol("NElement");function r(e){return e[t]||(e[t]=new o(e))}const d={diFull:e=>"calc(100% - "+e+")",rgb:(e,t,n,i=1)=>"rgba("+e+", "+t+", "+n+", "+i+")"};function c(e){return function t(n){var i=r(document.createElement(n.tagName||"div"));return["height","width","position","top","left","right","bottom","display","overflow"].forEach(e=>{n[e]&&i.setStyle(e,n[e])}),n.style&&i.setStyles(n.style),n.text&&i.setText(n.text),n.attr&&i.setAttrs(n.attr),n.classList&&i.element.classList.add(...n.classList),n.event&&Object.keys(n.event).forEach(e=>i.addEventListener(e,n.event[e])),n.child&&n.child.forEach(e=>{e&&(e instanceof o?i.addChild(e):i.addChild(t(e)))}),n.assembly&&n.assembly.forEach(e=>{(e=e(i))&&(i=e)}),i}(function t(n,i){var l={},r={};return Object.keys(i).forEach(e=>l[e]=i[e]),Object.keys(n).forEach(e=>{var t;"child"!=e&&("$"==e[0]?(t=e.slice(1),r[t]=i[t],l[t]=i[t]=n[e]):"$"==e.slice(-1)?(t=e.slice(0,-1),r[t]=i[t],i[t]=n[e]):l[e]=n[e])}),l.left&&l.right&&l.width&&delete l.width,l.top&&l.bottom&&l.height&&delete l.height,n.child&&(l.child=[],n.child.forEach(e=>{e&&(e instanceof o?l.child.push(e):l.child.push(t(e,i)))})),Object.keys(r).forEach(e=>i[e]=r[e]),l}(e,{}))}function s(t){var n=!1;return(...e)=>n?null:(n=!0,t(...e))}function a(e,t){for(var n=0,i=0;128&e[t];)if(n|=(127&e[t++])<<i,32<(i+=7))throw"Unexpected data length";return{num:n|=e[t++]<<i,ind:t}}var m=new class{storageKey="";map=new Map;constructor(e){null!=e&&this.setStorageKey(e)}reread(){this.map=new Map;var e,e=(e=this.storageKey+"-Map",localStorage.getItem(e));if(e){for(var t=function(e){for(var t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);for(var l=Math.floor(7*t/8),r=new Uint8Array(l),o=7,s=0,i=0;i<l;i++)r[i]=(n[s]&(1<<o)-1)<<8-o|n[s+1]>>o-1,s++,--o<=0&&(o=7,s++);return r}(e),n=t.length,i=new TextDecoder("utf-8"),l=0;l<n;l++){var r=0;({ind:l,num:r}=a(t,l));var o=i.decode(t.subarray(l,l+r));l+=r;var s=0;({ind:l,num:s}=a(t,l));r=i.decode(t.subarray(l,l+s));l+=s,this.map.set(o,r)}return!0}return!1}setStorageKey(e){return this.storageKey=e,this.reread()}set(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}delete(e){this.delete(e)}save(){var n=[];this.map.forEach((e,t)=>n.push(t,e));var t=[],i=new TextEncoder,l=0;n.forEach(e=>{e=i.encode(e);l+=5+e.length,t.push(e)});var e,r,o=new Uint8Array(l),s=0;t.forEach(e=>{s=function(e,t,n){for(;e;)t[n++]=127&e,e>>>=7;return n}(e.length,o,s),o.set(e,s),s+=e.length}),e=this.storageKey+"-Map",r=function(e){for(var t=e.length,n=Math.ceil(8*t/7),i=new Uint8Array(n),l=7,r=0,o=0;o<t;o++)i[r]|=e[o]>>8-l,i[r+1]|=(e[o]&(1<<8-l)-1)<<l-1,r++,--l<=0&&(l=7,r++);for(var s="",o=0;o<n;o++)s+=String.fromCharCode(i[o]);return s}(o.subarray(0,s)),localStorage.setItem(e,r)}};var h=r(document.body);h.setStyles({position:"fixed",height:"100%",width:"100%",margin:0,overflow:"hidden hidden",backgroundColor:d.rgb(15,15,15)});var n,e=r(document.createElement("style"));function u(e){e.setStyle("transition","transform 50ms linear, text-shadow 150ms linear"),e.addEventListener("mousedown",()=>{e.setStyle("transform","scale(0.95) translateY(2px)")}),e.addEventListener("mouseup",()=>{e.setStyle("transform","")}),e.addEventListener("mouseenter",()=>{e.setStyle("textShadow",`0 0 0.3em ${d.rgb(255,255,255,.5)}`),e.setStyle("transform","translateY(-1px)")}),e.addEventListener("mouseleave",()=>{e.setStyle("textShadow",""),e.setStyle("transform","")})}e.element.textContent=`
    input
    {
        outline: none;
    }
    *::-webkit-scrollbar {
        width: 5px;
        height: 1px;
    }
    *::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.1);
    }
    *::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
    }
`,h.addChild(e),n=!1,document.addEventListener("touchstart",e=>{n=!0,e.target.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))}),document.addEventListener("touchend",e=>{n=!0,e.target.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0}))}),document.addEventListener("mouseenter",e=>{n&&e.stopPropagation()},!0),document.addEventListener("mousemove",()=>{n=!1},!0);var g,f,i,p=c({position:"absolute",right:"0px",style:{userSelect:"none",pointerEvents:"none",zIndex:"30000"}});function y(e,t,n){var i=c({style:{backgroundColor:d.rgb(255,255,255,.95),marginRight:"1em",marginTop:"1em",marginLeft:"1em",float:"right",clear:"both",overflow:"hidden hidden",padding:"1em",boxSizing:"border-box",minWidth:"180px",borderRadius:"0.2em"},position:"relative",child:[{tagName:"i",classList:["fa","fa-info-circle"]},{text:e,style:{fontSize:"1.2em",lineHeight:"1.5em",fontWeight:"bolder"}},{text:t},{text:n,style:{fontSize:"0.9em",float:"right"}},{text:"×",position:"absolute",right:"4px",top:"1px",assembly:[u],style:{fontSize:"25px",lineHeight:"1em"},event:{click:s(()=>{l()})}}]});function l(){i.setStyle("pointerEvents","none"),i.element.animate([{},{transform:"translateX(180%)"}],270),setTimeout(()=>{i.setStyle("visibility","hidden"),i.element.animate([{height:i.element.clientHeight+"px"},{marginTop:0,height:0,padding:0}],150),setTimeout(()=>{i.remove()},150)},270)}p.addChild(i),i.element.animate([{transform:"translateX(180%) translateY(10%) scale(0.6)"},{}],180),setTimeout(()=>{i.setStyle("pointerEvents","auto")},180),setTimeout(()=>{l()},5e3)}function b(e,t,n,i,...l){var r=c({style:{padding:"1em",borderRadius:"0.9em",width:`${t}px`,height:`${n}px`,backgroundColor:d.rgb(255,255,255),color:d.rgb(0,0,0),flexDirection:i?"row":"column",alignItems:"center",justifyContent:"space-around",margin:"1em",boxSizing:"border-box",transition:"transform 50ms linear"},display:"flex",child:l,event:{click:e,mousedown:()=>{r.setStyle("transform","scale(0.97)")},mouseup:()=>{r.setStyle("transform","")},mouseenter:()=>{r.setStyle("outline",`2.5px solid ${d.rgb(255,255,255,.5)}`)},mouseleave:()=>{r.setStyle("outline",""),r.setStyle("transform","")}}});return r.element.animate({transform:["perspective(300px) rotateX(-20deg)","perspective(300px) rotateX(15deg)","perspective(300px) rotateX(-10deg)","perspective(300px) rotateX(5deg)","perspective(300px)"]},550),r}function x(){var t=null,n=[],i=0;function e(e){t.addChild(n[e]),e!=i&&n[e].element.animate([{opacity:.5,transform:"scale(0.97)"},{opacity:1}],100),i=e}var l,r,o,r=c({width:"100%",height:"100%",position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0),alignItems:"stretch",justifyContent:"space-between"},display:"flex",assembly:[e=>{function t(){h.element.clientWidth>h.element.clientHeight?e.setStyle("flexFlow","row"):e.setStyle("flexFlow","column-reverse")}window.addEventListener("resize",t),t()}],child:[{style:{backgroundColor:d.rgb(90,90,90,.5),color:d.rgb(255,255,255),alignItems:"center",justifyContent:"space-around"},display:"flex",assembly:[e=>{function t(){h.element.clientWidth>h.element.clientHeight?e.setStyle("flexFlow","column"):e.setStyle("flexFlow","row")}window.addEventListener("resize",t),t()}],child:[{width:"47px",height:"47px",assembly:[u],style:{textAlign:"center",fontSize:"23px",lineHeight:"47px"},event:{click:()=>{e(0)}},child:[{tagName:"i",classList:["fa-solid","fa-box-open"]}]},{width:"47px",height:"47px",assembly:[u],style:{textAlign:"center",fontSize:"23px",lineHeight:"47px"},event:{click:()=>{e(1)}},child:[{tagName:"i",classList:["fa-solid","fa-link"]}]},{width:"47px",height:"47px",assembly:[u],style:{textAlign:"center",fontSize:"23px",lineHeight:"47px",float:"bottom"},event:{click:()=>{e(2)}},child:[{tagName:"i",classList:["fa-solid","fa-user"]}]}]},{style:{flexGrow:1,alignItems:"stretch",justifyContent:"space-between"},display:"flex",assembly:[e=>{function t(){h.element.clientWidth>h.element.clientHeight?e.setStyle("flexFlow","column-reverse"):e.setStyle("flexFlow","column")}window.addEventListener("resize",t),t()}],child:[{display:"flex",text:"没有内容",style:{backgroundColor:d.rgb(75,75,75,.5),color:d.rgb(240,240,240),height:"30px"}},{position:"relative",style:{flexGrow:1},assembly:[e=>{t=e}],child:[(r=e=>{n[1]=e},o=null,r=c({width:"100%",height:"100%",position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0),color:d.rgb(255,255,255),alignItems:"stretch",justifyContent:"flex-start",flexFlow:"column",padding:"20px",boxSizing:"border-box",overflow:"hidden auto"},display:"flex",assembly:[r],child:[{text:"盒子",style:{fontSize:"3em",marginBottom:"1em"}},{display:"flex",style:{flexWrap:"wrap",justifyContent:"center"},assembly:[e=>{o=e}]}]}),a("本地服务","fa-desktop",()=>{}),a("建立临时对等连接","fa-link",()=>{a("测试",null,()=>{})}),r),c({width:"100%",height:"100%",position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0),color:d.rgb(255,255,255),alignItems:"stretch",justifyContent:"space-between",flexFlow:"column",padding:"20px",boxSizing:"border-box"},display:"flex",assembly:[e=>{n[2]=e}],child:[{text:"角色",style:{fontSize:"3em"}},{child:[{text:"本地角色"},{text:`角色名: ${m.get("name")}`},{text:`显示名称: ${m.get("name")}`}]}]}),(r=e=>{n[0]=e},l=null,r=c({width:"100%",height:"100%",position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0),color:d.rgb(255,255,255),alignItems:"stretch",justifyContent:"flex-start",flexFlow:"column",padding:"20px",boxSizing:"border-box",overflow:"hidden auto"},display:"flex",assembly:[r],child:[{text:"盒子",style:{fontSize:"3em",marginBottom:"1em"}},{display:"flex",style:{flexWrap:"wrap",justifyContent:"center"},assembly:[e=>{l=e}]}]}),s("测试添加盒子","fa-circle-plus",()=>{s("测试","fa-box-open",()=>{})}),r)]}]}]});function s(e,t,n){l.addChild(b(n,130,190,!1,c({tagName:"i",classList:["fa",t],style:{fontSize:"42px",textShadow:`0.2em 0.2em 10px ${d.rgb(0,0,0,.25)}`}}),c({text:e})))}function a(e,t,n){o.addChild(b(n,530,90,!0,c({tagName:"i",classList:["fa",t],style:{fontSize:"42px",textShadow:`0.2em 0.2em 10px ${d.rgb(0,0,0,.25)}`}}),c({text:e})))}h.addChild(r),r.element.animate([{opacity:0,transform:"scale(0.6) translateY(10%)"},{opacity:1}],100)}h.addChild(p),f=null,i=c({width:"100%",height:"100%",$position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0),alignItems:"center",justifyContent:"center"},display:"flex",child:[{width:"300px",height:"200px",style:{border:"1px white solid",backgroundColor:d.rgb(255,255,255,.05),color:d.rgb(255,255,255),alignItems:"center",justifyContent:"center",flexFlow:"column",lineHeight:"45px"},position$:"static",display:"flex",child:[{text:"登入以角色"},{tagName:"input",assembly:[e=>{f=e},u],style:{textAlign:"center"}},{text:"登录",assembly:[u],event:{click:(g=s(()=>{i.element.animate([{opacity:1},{opacity:0,transform:"scale(0.6) translateY(10%)"}],300),setTimeout(()=>{i.remove(),y("请稍后","准备初始化本地环境","qTown"),x()},300)}),async()=>{var n,i,l,e=f.element.value;e?m.setStorageKey(`character-${e}`)?g():(n="添加角色",i=`本地不存在此角色\n是否创建角色 ( ${e} )`,l=!0,await new Promise(e=>{var t=c({width:"100%",height:"100%",$position:"absolute",style:{userSelect:"none",backgroundColor:d.rgb(0,0,0,.7),alignItems:"center",justifyContent:"center",zIndex:"30000"},assembly:[e=>{e.element.animate([{opacity:.1},{opacity:1}],100)}],display:"flex",child:[{style:{border:"1px white solid",backgroundColor:d.rgb(255,255,255,.95),color:d.rgb(0,0,0),alignItems:"center",justifyContent:"center",flexFlow:"column",lineHeight:"45px",minHeight:"190px",minWidth:"280px"},assembly:[e=>{e.element.animate([{transform:"scale(0.6) translateY(10%)",opacity:0},{opacity:1}],170)}],position$:"static",display:"flex",child:[{text:n},{text:i},{text:"确定",assembly:[u],event:{click:()=>{t.remove(),e(!0)}}},l?{text:"取消",assembly:[u],event:{click:()=>{t.remove(),e(!1)}}}:null]}]});h.addChild(t)})&&(m.set("name",e),m.save(),g())):y("登录时错误","角色名不能为空","qTown")})}}]}]}),h.addChild(i),async function(){if("serviceWorker"in navigator)try{var e=await navigator.serviceWorker.register("/sw-test/sw.js",{scope:"/sw-test/"});e.installing?console.log("Service worker installing"):e.waiting?console.log("Service worker installed"):e.active&&console.log("Service worker active")}catch(e){console.error("Registration failed:",e)}else y("无法安装Service worker","当前浏览器环境无法注册Service worker 这可能对打开页面的速度有一定影响","qTown")}()}();